name: Install Blender Addon

on: [push]

jobs:
  install-addon:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout codes
        uses: actions/checkout@v3

      - name: Download Blender (if not included in the repository)
        run: |
          wget https://download.blender.org/release/Blender4.2/blender-4.2.0-linux-x64.tar.xz
          tar -xf blender-4.2.0-linux-x64.tar.xz
          ls -la blender-4.2.0-linux-x64
      
      - name: Install Python dependencies (if needed)
        run: |
          cd /home/runner/work/github-trial/github-trial/blender-4.2.0-linux-x64/4.2/python/bin
          pwd
          python -m pip install --target "/home/runner/work/github-trial/github-trial/blender-4.2.0-linux-x64/4.2/python/lib/site-packages" scipy
          echo "BUNYT"
          pwd
      
      - name: Just
        run: 

      - name: Create install_addon.py script
        run: |
          echo "
          import bpy
          import os
          import time

          time.sleep(15)  # Add delay to ensure Blender initializes
          
          addon_path = '/home/runner/work/github-trial/github-trial/animation_tool.zip'
       

          bpy.ops.preferences.addon_install(filepath=addon_path)
          bpy.ops.preferences.addon_enable(module=f"Metadata Beta 1.5.2")
          " > install_addon.py

      - name: Run install_addon.py in Blender
        run: |
          cd /home/runner/work/github-trial/github-trial/blender-4.2.0-linux-x64
          ./blender --background --python ../install_addon.py

      - name: Test Drone
        run: |
          cd /home/runner/work/github-trial/github-trial
          python btest.py
